### this file configures this service for use by the form8 CLI to automate build/deploy/testing of it

# general info for the service
general:
  name: form8joker


# components of the service
components:
  # a stateless component that serves jokes over http
  # the hostname is the same as the below name, so 'web' in this case
  - name: web
    type: stateless
    instances: 1 # this is the default
    containers:
      # consists of a single container whose Dockerfile is in the same dir as this file
      - dir: .
        # this check is run periodically to determine the health of each instance -- deployment only succeeds if this starts passing
        readyCheck:
          httpGet:
            port: 80
            path: /health
    # expose container port 80 on host 'web' port 80 and create an external endpoint accessible from the network 'minikube'
    expose:
      - servicePort: 80
        containerPort: 80
        accessible-from:
          - minikube
          - form8demo


# tests that can be run against components of this service
# a test succeeds if all container instances exit with status zero, else fails
tests:
  # functional test that simply curl's web:80/joke
  - name: func
    instances: 1 # this is the default
    containers:
      # consists of a single container whose Dockerfile is in dir 'tests/func'
      - dir: tests/func


# OPTIONAL section that specifies the types of environments that can be deployed as well as modifications that should take place to the above config for each
#   The type is passed to the 'deploy' action via the '--type' argument
env-types:
  - name: dev
    # the modification to apply
    modifier:
      # for all containers of all components, add the environment variable 'DEBUG' with value 'on'
      components:
        - name: .*
          containers:
            - name: .*
              envVars:
                DEBUG: 'on'
